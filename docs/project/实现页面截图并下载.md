---
sidebar:
  title: å®ç°é¡µé¢æˆªå›¾å¹¶ä¸‹è½½
  step: 1
  isTimeLine: true
title: å®ç°é¡µé¢æˆªå›¾å¹¶ä¸‹è½½
tags:
  - é¡¹ç›®
categories:
  - é¡¹ç›®
---

## å®ç°é¡µé¢æˆªå›¾å¹¶ä¸‹è½½

## ç®€ä»‹

è¿™é‡Œè®°å½•ä¸€ä¸‹é¡µé¢æˆªå›¾å¹¶ä¸‹è½½çš„å®ç°æ–¹æ³•ï¼Œç®€å•æ­å»ºä¸€ä¸ª demo é¡¹ç›®ï¼ˆ[é¡¹ç›®åœ°å€](https://github.com/iygxv/html2canvas-demo)ï¼‰

å…·ä½“çš„å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

- é€šè¿‡ html2canvas ç”Ÿæˆ canvas
- é€šè¿‡ canvas.toDataURL() ç”Ÿæˆ base64 æ•°æ®
- é€šè¿‡ a æ ‡ç­¾ä¸‹è½½ base64 æ•°æ®ï¼ˆåˆ°è¿™é‡Œå°±æ˜¯å›¾ç‰‡äº†ï¼‰

## å…·ä½“çš„ä»£ç 

ä¸‹é¢ä»£ç æ˜¯å¯¹å®ç°é¡µé¢æˆªå›¾å¹¶ä¸‹è½½å°è£…çš„å‡½æ•°ï¼Œåªéœ€è¦è°ƒç”¨å³å¯

```js
import html2canvas from "html2canvas";
export async function downloadImage(
  id,
  options = {},
  downloadName = "image.png"
) {
  const element = document.getElementById(id);
  // é»˜è®¤é…ç½®
  const { useCORS = true, scale = window.devicePixelRatio * 2 } = options;
  const canvas = await html2canvas(element, {
    useCORS,
    scale,
  });
  const dataUrl = canvas.toDataURL();
  downloadFile(downloadName, dataUrl);
}

function downloadFile(name, code) {
  const aLink = document.createElement("a");
  aLink.download = name;
  aLink.href = code;
  aLink.click();
}
```

## é¡¹ç›®ä¸­è°ƒç”¨

```vue
<template>
  <div class="hello">
    <div class="operation-btn">
      <button @click="handleDownLoad">ä¸‹è½½å›¾ç‰‡</button>
    </div>
    <div class="content">
      <ImageDom id="imageDom" />
    </div>
  </div>
</template>

<script>
import { downloadImage } from "@/utils/index.js";
import ImageDom from "./ImageDom.vue";
export default {
  name: "HelloWorld",
  components: { ImageDom },
  methods: {
    handleDownLoad() {
      this.$nextTick(async () => {
        downloadImage("imageDom", {}, "download.png");
      });
    },
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.operation-btn {
  margin: 16px;
  text-align: left;
}
.content {
  width: 100%;
  height: 400px;
  overflow: auto;
  margin: auto;
  display: flex;
  justify-content: center;
}
</style>
```

## ä½¿ç”¨ html2canvas å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜

### å›¾ç‰‡è·¨åŸŸé—®é¢˜

ç”±äº `html2canvas` å—æµè§ˆå™¨åŒæºç­–ç•¥çš„é™åˆ¶, æ‰€ä»¥å¦‚æœè¦æˆªå›¾çš„é¡µé¢ä¸­å­˜åœ¨è·¨åŸŸçš„å›¾ç‰‡, éœ€è¦è®¾ç½® `useCORS` ä¸º `true`

### å›¾ç‰‡æ¸…æ™°åº¦é—®é¢˜

é€šè¿‡é…ç½®é¡¹å°† `scale` å±æ€§å¯¹åº”çš„å€¼è°ƒæ•´å¤§ä¸€ç‚¹å³å¯ï¼Œæˆ‘é¡¹ç›®ä¸­è®¾ç½®çš„æ˜¯ `window.devicePixelRatio * 2`, åœ¨ `html2canvas` ä¸­ `scale` é»˜è®¤å€¼ä¸ºæµè§ˆå™¨è®¾å¤‡åƒç´ æ¯”ã€‚

æµè§ˆå™¨è®¾å¤‡åƒç´ æ¯” å¯ä»¥é€š `window.devicePixelRatio` è·å–

å¯¹ canvas è¿›è¡Œç­‰æ¯”æ”¾å¤§ï¼Œå¯ä»¥ä½¿ canvas ç”Ÿæˆçš„å›¾ç‰‡æ›´æ¸…æ™°ï¼ŒåŒæ—¶å¯¼å‡ºçš„æ–‡ä»¶å¤§å°ä¹Ÿä¼šåŒæ­¥å¢åŠ ã€‚

### å›¾ç‰‡æ ·å¼ç¼ºå¤±

æ­¤é—®é¢˜çš„åŸå› åœ¨äº `html2canvas` æœ‰ä¸€äº› css æ ·å¼æ˜¯ä¸æ”¯æŒçš„ï¼Œå¯¼è‡´æˆªå–å‡ºæ¥çš„å›¾ç‰‡æœ‰éƒ¨åˆ†æ ·å¼ç¼ºå¤±ã€‚å› æ­¤å†™é¡µé¢çš„æ—¶å€™åªè¦è‡ªå·±æ³¨æ„ä¸€ä¸‹å°±å¥½äº†ã€‚

å®˜æ–¹æ–‡æ¡£ä¸Šé¢ä¹Ÿæœ‰è¯´æ˜æ”¯æŒå“ªäº› css å±æ€§ï¼Œä¸æ”¯æŒå“ªäº› css å±æ€§ã€‚å…·ä½“è¯¦æƒ…å¯ä»¥ç‚¹å‡»[ä¼ é€é—¨](https://html2canvas.hertzen.com/features)ã€‚

ä¸‹é¢è¿™äº› css å±æ€§æ˜¯å½“å‰ä¸æ”¯æŒçš„ï¼š

- [background-blend-mode](https://github.com/niklasvh/html2canvas/issues/966)
- [border-image](https://github.com/niklasvh/html2canvas/issues/1287)
- [box-decoration-break](https://github.com/niklasvh/html2canvas/issues/552)
- [box-shadow](https://github.com/niklasvh/html2canvas/pull/1086)
- [filter](https://github.com/niklasvh/html2canvas/issues/493)
- [font-variant-ligatures](https://github.com/niklasvh/html2canvas/pull/1085)
- [mix-blend-mode](https://github.com/niklasvh/html2canvas/issues/580)
- [object-fit](https://github.com/niklasvh/html2canvas/issues/1064)
- [repeating-linear-gradient()](https://github.com/niklasvh/html2canvas/issues/1162)
- [writing-mode](https://github.com/niklasvh/html2canvas/issues/1258)
- [zoom](https://github.com/niklasvh/html2canvas/issues/732)

### é•¿å›¾æˆªå–ä¸å…¨

- è§£å†³æ–¹æ¡ˆï¼š ç»™è¦æˆªå›¾çš„å…ƒç´ è®¾ç½® `heightï¼šfit-content`
  **æ³¨æ„ï¼šfit-content æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„è¯¥å±æ€§æ˜¯å¦ç¬¦åˆä½ çš„ç›®æ ‡æµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚**

  ç»™æˆªå›¾å…ƒç´ ä¸è®¾ç½®é«˜åº¦æˆ–è€…è®¾ç½® height: auto å‘ç°éƒ½ä¸èµ·ä½œç”¨ï¼Œåæ¥å°è¯•ä½¿ç”¨ fit-content è¿™ä¸ªç›¸å¯¹è¾ƒæ–°çš„å±æ€§åï¼Œå¯ä»¥å®Œç¾è§£å†³é«˜åº¦é—®é¢˜ã€‚

- æ‰©å±•çŸ¥è¯†
  `height: fit-content` ç”¨äºæ ¹æ®å…ƒç´ å†…å®¹çš„å¤§å°æ¥è‡ªåŠ¨è°ƒæ•´å…ƒç´ çš„é«˜åº¦ã€‚å®ƒå…è®¸ä½ æ ¹æ®å†…å®¹åŠ¨æ€åœ°è®¾ç½®å…ƒç´ çš„é«˜åº¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å›ºå®šçš„åƒç´ å€¼æˆ–ç™¾åˆ†æ¯”ã€‚ï¼ˆè¿™æ®µè¯æ¥è‡ª chatGPTï¼‰

  å¦å¤– fit-content å¯ä»¥å’Œ min-height å’Œ max-height æ­é…ä½¿ç”¨ã€‚

  - ä¸ min-height æ­é…ä½¿ç”¨ï¼šå½“å†…å®¹å®é™…é«˜åº¦å°äºæŒ‡å®šçš„æœ€å°é«˜åº¦æ—¶ï¼Œå…ƒç´ çš„é«˜åº¦ä¸º min-height æŒ‡å®šçš„é«˜åº¦ï¼Œå¦åˆ™ä¸ºå…ƒç´ çš„å®é™…é«˜åº¦ã€‚ã€‚
  - ä¸ max-height æ­é…ä½¿ç”¨ï¼šå½“å†…å®¹é«˜åº¦å¤§äºæŒ‡å®šçš„æœ€å¤§é«˜åº¦æ—¶ï¼Œå…ƒç´ çš„é«˜åº¦ä¸º max-height æŒ‡å®šçš„é«˜åº¦ï¼Œå¦åˆ™ä¸ºå…ƒç´ çš„å®é™…é«˜åº¦ã€‚

## æ€»ç»“

å®ç°é¡µé¢æˆªå›¾å¹¶ä¸‹è½½æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹ `html2canvas` çš„ä¸€äº›å°å‘

## å‚è€ƒæ–‡ç« 

https://juejin.cn/post/7336921343207145512#heading-6

<br/>
<hr />

â­ï¸â­ï¸â­ï¸ å¥½å•¦ï¼ï¼ï¼æœ¬æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸå•¦ã€‚â­ï¸â­ï¸â­ï¸

âœ¿âœ¿ ãƒ½(Â°â–½Â°)ãƒ âœ¿

æ’’èŠ± ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸
