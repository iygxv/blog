---
sidebar:
  title: ç²¾åº¦é—®é¢˜å¯¼è‡´çš„çº¿ä¸Šbug
  step: 1
  isTimeLine: true
title: ç²¾åº¦é—®é¢˜å¯¼è‡´çš„çº¿ä¸Šbug
tags:
  - é¡¹ç›®
categories:
  - é¡¹ç›®
---

# ç²¾åº¦é—®é¢˜å¯¼è‡´çš„çº¿ä¸Š bug

## é—®é¢˜

æœåŠ¡ç«¯è¿”å›çš„æ•°æ® idï¼ˆ10976458979374927ï¼‰ï¼Œè¶…å‡º `Number` ç±»å‹èŒƒå›´ï¼Œå¯¼è‡´çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜çš„

## ç²¾åº¦ä¸¢å¤±é—®é¢˜

åœ¨ JavaScript ä¸­ï¼ŒNumber ç±»å‹èŒƒå›´ `-2^53 + 1` åˆ° `2^53 - 1`

ES6 å¼•å…¥äº† `Number.MAX_SAFE_INTEGER` å’Œ `Number.MIN_SAFE_INTEGER` è¿™ä¸¤ä¸ªå¸¸é‡ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªèŒƒå›´çš„ä¸Šä¸‹é™ã€‚

`Number.isSafeInteger()`ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦è½åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ã€‚

```js
Number.isSafeInteger(10976458979374927); // false
Number.isSafeInteger(10976458979374928); // false
Number.isSafeInteger(10976458979374929); // false
```

ä¸ºå•¥åç«¯çš„æ•°æ®æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿ

åœ¨ Java ä¸­ Long ç±»å‹çš„å–å€¼èŒƒå›´æ˜¯ `-2^63 + 1` åˆ° `2^63 - 1` , æ¯” JavaScript ä¸­å¤§å¾ˆå¤šï¼Œæ‰€ä»¥åç«¯èƒ½æ­£å¸¸å¤„ç†ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼šæœåŠ¡ç«¯è¿”å›çš„æ•°æ® idï¼ˆ10976458979374927ï¼‰ï¼Œè¶…å‡º `Number` ç±»å‹èŒƒå›´ï¼Œå¯¼è‡´çš„ç²¾åº¦ä¸¢å¤±ï¼Œå¯¼è‡´è¯·æ±‚æ¥å£æ˜¯æ‹¿ä¸åˆ°ç›¸åº”çš„æ•°æ®ï¼Œå¯¼è‡´çš„çº¿ä¸Šé—®é¢˜

## è§£å†³æ–¹æ¡ˆ

å¤„ç†æ–¹æ¡ˆï¼šåç«¯å¤„ç†

- æ•°æ®åº“ä¸­å­˜çš„å°±æ˜¯æ•°å€¼å‹ï¼Œä¿®æ”¹æ•°æ®åº“å­˜çš„ç±»å‹ä¸ºå­—ç¬¦ä¸²
- è¿”å›æ¥å£æ—¶è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ç»™å‰ç«¯

## å‰ç«¯å¤„ç†

å‰ç«¯å¤„ç†è¿™è¾¹æœ‰ 2 ç§æ–¹æ¡ˆï¼šæ­£åˆ™æ›¿æ¢ + json åºåˆ—åŒ–å¤„ç†

### æ­£åˆ™æ›¿æ¢

å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ axios è¯·æ±‚æ•°æ®ï¼ŒAxios æä¾›äº†è‡ªå®šä¹‰å¤„ç†åŸå§‹åç«¯è¿”å›æ•°æ®çš„ APIï¼štransformResponse , å¯ä»¥è¿™æ ·å¤„ç†ï¼š

```js
axios({
  method: method,
  url: url,
  data: data,
  transformResponse: [
    function (data) {
      // å°†Longç±»å‹æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²
      const convertedJsonString = data.replace(
        /"(\w+)":(\d{15,})/g,
        '"$1":"$2"'
      );
      return JSON.parse(convertedJsonString);
    },
  ],
});

// å‡è®¾åç«¯è¿”å›çš„JSONæ•°æ®å¦‚ä¸‹ï¼š
const responseData = {
  id: 12345678901234567890, // è¿™æ˜¯ä¸€ä¸ªLongç±»å‹æ•°æ®
  name: "sy",
};

// å¤„ç†è¿‡çš„jsonæ•°æ®
console.log(responseData.id); // è¿™å°†è¾“å‡ºå­—ç¬¦ä¸²ï¼š"12345678901234567890"
console.log(typeof responseData.id); // è¿™å°†è¾“å‡º "string"
```

### json åºåˆ—åŒ–å¤„ç†

æˆ‘ä»¬å¯ä»¥å€ŸåŠ©`json-bigint`è¿™ä¸ªç¬¬ä¸‰æ–¹åŒ…æ¥å¤„ç†ã€‚

`json-bigint` ä¸­çš„ parse æ–¹æ³•ä¼šæŠŠè¶…å‡º JS å®‰å…¨æ•´æ•°èŒƒå›´çš„æ•°å­—è½¬ä¸ºä¸€ä¸ª `BigNumber` ç±»å‹çš„å¯¹è±¡ï¼Œå¯¹è±¡æ•°æ®æ˜¯å®ƒå†…éƒ¨çš„ä¸€ä¸ªç®—æ³•å¤„ç†ä¹‹åçš„ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™è½¬ä¸ºå­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚

é€šè¿‡å¯ç”¨ `storeAsString` é€‰é¡¹,å¯ä»¥å¿«é€Ÿå°† `BigNumber` è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
import JSONbig from "json-bigint";
axios({
  method: method,
  url: url,
  data: data,
  transformResponse: [
    function (data) {
      const JSONbigToString = JSONbig({ storeAsString: true }); // å°†Longç±»å‹æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²
      return JSONbigToString.parse(data);
    },
  ],
});

// å‡è®¾åç«¯è¿”å›çš„JSONæ•°æ®å¦‚ä¸‹ï¼š
const responseData = {
  id: 12345678901234567890, // è¿™æ˜¯ä¸€ä¸ªLongç±»å‹æ•°æ®
  name: "sy",
};

// å¤„ç†è¿‡çš„jsonæ•°æ®
console.log(responseData.id); // è¿™å°†è¾“å‡ºå­—ç¬¦ä¸²ï¼š"12345678901234567890"
console.log(typeof responseData.id); // è¿™å°†è¾“å‡º "string"
```

## æ€»ç»“

- æœåŠ¡ç«¯è¿”å›çš„æ•°æ®å¦‚æœæ˜¯ Long ç±»å‹å¤ªé•¿å¯èƒ½ä¼šè¶…å‡º `Number` ç±»å‹èŒƒå›´ï¼Œå¯¼è‡´ç²¾åº¦ä¸¢å¤±
- å¯¼è‡´çš„ç²¾åº¦ä¸¢å¤±åï¼Œéœ€è¦åç«¯è¿›è¡Œå¤„ç†
- å‰ç«¯å¦‚æœç”¨ axios è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™æ›¿æ¢æˆ–è€… json åºåˆ—åŒ–å¤„ç†

<br/>
<hr />

â­ï¸â­ï¸â­ï¸ å¥½å•¦ï¼ï¼ï¼æœ¬æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸå•¦ã€‚â­ï¸â­ï¸â­ï¸

âœ¿âœ¿ ãƒ½(Â°â–½Â°)ãƒ âœ¿

æ’’èŠ± ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸
