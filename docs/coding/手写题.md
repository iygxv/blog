---
sidebar:
 title: æ‰‹æ’•ä»£ç ï¼ˆjs ç‰ˆæœ¬ï¼‰
 step: 5
 isTimeLine: true
title: æ‰‹æ’•ä»£ç ï¼ˆjs ç‰ˆæœ¬ï¼‰
tags:
 - æ‰‹æ’•ä»£ç 
categories:
 - æ‰‹æ’•ä»£ç 
---

# æ‰‹å†™é¢˜

## é˜²æŠ–èŠ‚æµ

### é˜²æŠ–

åœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…åªå…è®¸ä½ æä¾›çš„å›è°ƒå‡½æ•°æ‰§è¡Œä¸€æ¬¡ï¼Œä»¥æ­¤é™ä½å®ƒçš„æ‰§è¡Œé¢‘ç‡

#### å®ç°

```js
/**
 * é˜²æŠ–å‡½æ•°
 * @param {*} fn å›è°ƒå‡½æ•°
 * @param {*} delay å»¶è¿Ÿçš„æ—¶é—´
 * @param {*} immediate ç«‹å³æ‰§è¡Œ
 */
 const debounce = (fn, delay, immediate) => {
  let timer = null // ä½¿ç”¨é—­åŒ…ç¼“å­˜ç»“æœ
  return function () {
    let callNow = immediate && !timer // ç«‹å³æ‰§è¡Œ
    // å¦‚æœå·²ç»åœ¨é˜²æŠ–äº†
    if (timer) {
      clearTimeout(timer)
    }
    // æœ‰ç«‹å³æ‰§è¡Œ, å³é©¬ä¸Šæ‰§è¡Œ,å¦åˆ™ç­‰å¾…æ‰§è¡Œ
    if (callNow) {
      fn.call(this, ...arguments)
    } else {
      timer = setTimeout(() => {
        fn.call(this, ...arguments)
        // æ‰§è¡Œå®Œæ¯•å
        timer = null
      }, delay)
    }
  }
}

```

#### é˜²æŠ–åœºæ™¯

- searchæœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚
- windowè§¦å‘resizeçš„æ—¶å€™ï¼Œä¸æ–­çš„è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä¼šä¸æ–­çš„è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œç”¨é˜²æŠ–æ¥è®©å…¶åªè§¦å‘ä¸€æ¬¡

### èŠ‚æµ

 å•ä½æ—¶é—´å†…åªèƒ½è§¦å‘ä¸€æ¬¡

#### å®ç°

```js
/**
 * èŠ‚æµå‡½æ•°
 * @param {*} fn å›è°ƒå‡½æ•°
 * @param {*} delay å»¶è¿Ÿæ—¶é—´
 * @returns
 */
function throttle(fn, delay) {
  var flag = false // å¼€å§‹çš„æ—¶å€™, falseæ ‡å¿—æœªå¼€å§‹, trueæ ‡å¿—å¼€å§‹
  return function () {
    if (flag) return
    flag = true // æ ‡å¿—å¼€å§‹
    setTimeout(() => {
      fn.apply(this, arguments) // å½“è¿è¡Œå®Œè¿™æ¬¡äº‹ä»¶
      flag = false // æ ‡å¿—å›æœªå¼€å§‹
    }, delay)
  }
}
```

#### èŠ‚æµåœºæ™¯

- é¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œmousedown(å•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡)
- ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œç”¨throttleæ¥åˆ¤æ–­

## æ·±æ‹·è´

### å®ç°

```js
const isObject = val => typeof val === 'object' && val !== null
const toTypeString = val => Object.prototype.toString.call(val)

const deepCopy = (obj, hash = new WeakMap()) => {
  // éå¯¹è±¡ç±»å‹ä¸æ‹·è´
  if (!isObject(obj)) return obj
  // å¯¹è±¡ä¸ºæ­£åˆ™æˆ–è€…æ—¥æœŸ å¯¹è±¡, ä¹Ÿä¸è¿›è¡Œæ‹·è´
  if (toTypeString(obj) === '[object RegExp]') return obj
  if (toTypeString(obj) === '[object Date]') return obj

  // å¦‚æœæœ‰å¾ªç¯å¼•çš„ç°è±¡, ä¸åœ¨ç»§ç»­æ‹·è´,è¿”å›ä¹‹å‰çš„
  if (hash.has(obj)) return obj
  // å¼€å§‹æ‹·è´
  let newObj = Array.isArray(obj) ? [] : {}
  hash.set(obj, newObj) // å­˜å‚¨
  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      // ä¸æ‹·è´ç»§æ‰¿çš„å±æ€§
      newObj[key] = isObject(obj[key]) ? deepCopy(obj[key], hash) : obj[key]
    }
  }
  return newObj
}
```

#### æ³¨æ„ç‚¹

- å¾ªç¯å¼•ç”¨çš„å¤„ç†
- ä¸æ‹·è´ç»§æ‰¿çš„å±æ€§çš„å¤„ç†

## æ¨¡æ¿å­—ç¬¦ä¸²è§£æ

### é¢˜ç›®æè¿°

```js
let template = 'æˆ‘æ˜¯{{name}}ï¼Œå¹´é¾„{{age}}ï¼Œæ€§åˆ«{{sex}}'
let data = {
  name: 'å°æ˜',
  age: 18
}

// è¦æ±‚å†™ä¸€ä¸ªå‡½æ•°ä½¿ç¼–è¯‘ç»“æœä¸º
render(template, data) // æˆ‘æ˜¯å°æ˜ï¼Œå¹´é¾„18ï¼Œæ€§åˆ«undefined
```

### å®ç°

```js
function render(template, data) {
  // \ä¸ºè½¬ä¹‰
  let str = template.replace(/\{\{(\w+)\}\}/g, (match, key) => {
    /*
     *match =>{{name}} å­—ç¬¦ä¸²ä¸­åŒ¹é…åˆ°çš„
     *key =>name  ä»£è¡¨æ‹¬å·åŒ¹é…çš„å­—ç¬¦ä¸²
     */
    return data[key]
  })
  return str
}
```

## LRUç®—æ³•

### æè¿°

- LRUç®—æ³•ä¹Ÿå«åš`æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•`

- LRUç®—æ³•çš„åŸç†: æ¯æ¬¡è·å–å€¼çš„æ—¶å€™éƒ½ä¼šé‡æ–°è®¾ç½®å€¼, æ‰€ä»¥æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å¿…ç„¶æ˜¯æœ€å‰é¢çš„é‚£ä¸ª

### å®ç°

```js
/**
 * capacity å­˜å‚¨çš„æœ€å¤§å®¹é‡
 */
class LRUCache {
  constructor(capacity) {
    this.secretKey = new Map()
    this.capacity = capacity
  }
  // è·å–å€¼
  get(key) {
    if(this.secretKey.has(key)) {
      let templateValue = this.secretKey.get(key)
      this.secretKey.delete(key) // åˆ é™¤å½“å‰çš„
      this.secretKey.set(key, templateValue) // é‡æ–°è®¾ç½®, å¹¶æ’åœ¨æœ€å
      return templateValue
    }else {
      return -1
    }
  }
  // è®¾ç½®å€¼
  set(key, value) {
    // å¦‚æœå·²ç»å­˜åœ¨, ä¿®æ”¹
    if(this.secretKey.has(key)) {
      this.secretKey.delete(key) // åˆ é™¤å½“å‰çš„
      this.secretKey.set(key, value) // é‡æ–°è®¾ç½®, å¹¶æ’åœ¨æœ€å
    }else if(this.secretKey.size < this.capacity) { // å¦‚æœcacheè¶³å¤Ÿ, ç»§ç»­æ”¾
      this.secretKey.set(key, value) // é‡æ–°è®¾ç½®, å¹¶æ’åœ¨æœ€å
    }else {
      // å…ˆæ·»åŠ è¿›å»
      this.secretKey.set(key, value)
      // ç„¶åå†åˆ é™¤ç¬¬ä¸€ä¸ª(å³æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„)
      this.secretKey.delete(this.secretKey.keys().next().value)
    }
  }
}


// æµ‹è¯•
let cache = new LRUCache(2) // æœ€å¤§å®¹é‡2
// å­˜æ”¾ä¿©ä¸ª
cache.set('test', 'testç»„ä»¶')
cache.set('test2', 'test2ç»„ä»¶')

// è·å–
cache.get('test') // testç»„ä»¶

// å†æ¬¡å­˜æ”¾, å› ä¸ºæœ€å¤§å®¹é‡ä¸º2, å¹¶ä¸”åœ¨ä¸Šé¢å·²ç»è·å–äº†test ,å› æ­¤æœ€å°‘ä½¿ç”¨çš„æ˜¯test2, æ‰€ä»¥å‰”é™¤
cache.set('test3', 'test3ç»„ä»¶')
// cache =>  Map(2) {'test' => 'testç»„ä»¶', 'test3' => 'test3ç»„ä»¶'}
```

## æ•°å­—åƒåˆ†ä½åˆ†å‰²

ä¸ºä»€ä¹ˆæ•°å­—ä½¿ç”¨åƒåˆ†ä½åˆ†å‰², æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› 

- é˜²æ­¢è¢«æµè§ˆå™¨è¡¨ç¤ºä¸ºæ‰‹æœºå·ç ï¼Œå½±å“æœ¬æ„
- èƒ½è®©è¯­éŸ³é˜…è¯»æ•´ä½“é˜…è¯», æ¯”å¦‚ 123456789ï¼Œè¯» ä¸€äº¿ä¸¤åƒä¸‰ç™¾å››åäº”ä¸‡å…­åƒä¸ƒç™¾å…«åä¹ï¼›è€Œä¸æ˜¯ ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹
- æ›´åŠ ç¬¦åˆå›½é™…é€šç”¨è§„èŒƒ

#### å®ç°

```js
function formatNum(num) {
  // 1. è½¬åŒ–ä¸ºå­—ç¬¦ä¸²æ›´å¥½æ“ä½œ
  let strNum = num.toString()
  // 2. çœ‹æ˜¯å¦æœ‰å°æ•°ç‚¹ä»¥åŠè·å–åˆ°å°æ•°
  let decimals = ''
  if(strNum.includes('.')) { // åŒ…å«å°æ•°ç‚¹
     let [num, decimal] = strNum.split('.') // æ•°ç»„è§£æ„ => è§£æ„å‡ºæ¥ä¾‹å¦‚123.45 => [123, 45] 45ä¸ºå°æ•° 
     strNum = num
     decimals = decimal
  }
  // 3. çœ‹numé•¿åº¦
  let len = strNum.length
  if(len < 3) {  // æ•´æ•°éƒ¨åˆ†ä¸å¤Ÿä¸‰ä½, ä¸åˆ†å‰²
    return decimals ? strNum + `.${decimals}` : decimals
  }else { // åˆ†å‰²
    // å¯ä»¥è¿›è¡Œ
    let temp = ''
    let remainder = len % 3 // è·å–åˆ°æ˜¯å¦3çš„å€æ•°
    decimals ? temp = '.' + decimals : temp // è·å–åˆ°åˆ†æ•°
    if(remainder > 0) {
      let beforeNum = strNum.slice(0, remainder) // æˆªå–å‰é¢ä¸è¶³3ä½çš„
      /**
      * matchè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„
      * å¦‚æœä½¿ç”¨gæ ‡å¿—ï¼Œåˆ™å°†è¿”å›ä¸å®Œæ•´æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ‰€æœ‰ç»“æœï¼Œä½†ä¸ä¼šè¿”å›æ•è·ç»„ã€‚
      * å¦‚æœæœªä½¿ç”¨gæ ‡å¿—ï¼Œåˆ™ä»…è¿”å›ç¬¬ä¸€ä¸ªå®Œæ•´åŒ¹é…åŠå…¶ç›¸å…³çš„æ•è·ç»„ï¼ˆArrayï¼‰ã€‚
      * ä¾‹å¦‚: '123455'.match(/\d{3}/g) => ['123', '455']
      * '123455'.match(/\d{3}/) æ²¡æœ‰ä½¿ç”¨gæ ‡å¿— ['123', index: 0, input: '123455', groups: undefined]
      */
      let middleNum = strNum.slice(remainder, len).match(/\d{3}/g).join(',') // æˆªå–ä¸­é—´
      let afterNum = temp // å°æ•°ç‚¹
      return beforeNum + middleNum + afterNum
    }else {
      let middleNum = strNum.slice(0, len).match(/\d{3}/g).join(',')
      let afterNum = temp
      return middleNum + afterNum
    }
  }
}
```

## å‡½æ•°æŸ¯é‡ŒåŒ–

### æè¿°

- æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°(æœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°)çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°ä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯

### å®ç°

```js
/**
 * 
 * @param {*} fn å‡½æ•°
 * @param  {...any} args å¤šä¸ªå‚æ•° 
 */
function currying(fn, ...args) {
  // 1.è·å–åˆ°fnå‚æ•°ä¸ªæ•°
  const len = fn.length 
  // 2.æ”¶é›†å‚æ•°
  let allArgs = [...args]
  const dfs = (...args2) => {
    // ç»§ç»­æ”¶é›†å‚æ•°
    allArgs = [...allArgs, ...args2] // 3.æ”¶é›†è¿”å›å‡½æ•°çš„å‚æ•°(ä½¿ç”¨é—­åŒ…, ä¸€ç›´ä¿å­˜allArgs)
    if(len === allArgs.length) {
      // 4.1æ”¶é›†å®Œæ¯•
      return fn(...allArgs)
    }else {
      // 4.2ç»§ç»­æ”¶é›†
      return dfs
    }
  }
  return dfs
}

let fn = (a, b, c) => {
  return a + b + c
}
// let add = currying(fn, 3, 4)
// let ret = add(5)
// è¿ç»­ä½¿ç”¨ -- æ”¶é›†åˆ°ä¸€å®šå‚æ•°æ‰ä¼šå»è°ƒç”¨å‡½æ•°, å¦åˆ™è¿˜æ˜¯è¿”å›å‡½æ•°
let ret = currying(fn, 3, 4)(5)
console.log(ret); //12
```

## newæ“ä½œç¬¦

newæ“ä½œç¬¦åˆ†æ

- newå‡ºæ¥çš„å¯¹è±¡thisæŒ‡å‘å®ä¾‹æœ¬èº«
- å®ä¾‹.__proto === æ„é€ å‡½æ•°.prototype
- ä¼šè‡ªè¡Œå‡½æ•°
- æ ¹æ®è¿”å›å€¼ç±»å‹è¿”å›

### å®ç°

```js
/**
 * 
 * @param {*} fn æ„é€ å‡½æ•° 
 * @param  {...any} args  å‰©ä½™å‚æ•°
 */
const myNew = (fn, ...args) => {
  // 1.åˆ›å»ºä¸€ä¸ªå¯¹è±¡, å¹¶ä¸”ä»¥fn.prototypeä½œä¸ºåŸå‹
  let obj = Object.create(fn)
  // 2.è°ƒç”¨å‡½æ•°, å¹¶å°†thisæ‰§è¡Œobj
  let ret = fn.call(obj, ...args)
  // 3.åˆ¤æ–­è¿”å›å€¼
  return ret instanceof Object ? ret : obj
}

// æµ‹è¯•
function Person(name) {
  this.name = name
}
const p = myNew(Person, 'xm') 
```

## åˆ—è¡¨ä¸æ ‘å½¢ç»“æ„äº’è½¬

### åˆ—è¡¨è½¬æˆæ ‘å½¢ç»“æ„

```js
let data = [
  {
    id: 1,
    text: 'èŠ‚ç‚¹1',
    parentId: 0 //è¿™é‡Œç”¨0è¡¨ç¤ºä¸ºé¡¶çº§èŠ‚ç‚¹
  },
  {
    id: 2,
    text: 'èŠ‚ç‚¹1_1',
    parentId: 1 //é€šè¿‡è¿™ä¸ªå­—æ®µæ¥ç¡®å®šå­çˆ¶çº§
  },
  {
    id: 3,
    text: 'èŠ‚ç‚¹2_1',
    parentId: 2 //é€šè¿‡è¿™ä¸ªå­—æ®µæ¥ç¡®å®šå­çˆ¶çº§
  }
]

// è½¬æˆ
// [
//   {
//       id: 1,
//       text: 'èŠ‚ç‚¹1',
//       parentId: 0,
//       children: [
//           {
//               id:2,
//               text: 'èŠ‚ç‚¹1_1',
//               parentId:1
//           }
//       ]
//   }
// ]
```

#### è½¬åŒ–å‡½æ•°

```js
function listToTree(data) {
  let temp = {}
  let treeDate = []
  // å‡å°‘å¾ªç¯æ“ä½œ
  data.forEach((item) => {
    temp[item.id] = item
  })
  // éå†åŠ å…¥
  for (let key in temp) {
    // å¦‚æœä¸æ˜¯æœ€å¤§çˆ¶çº§
    if (temp[key].parentId !== 0) {
      // æ‰¾åˆ°çˆ¶äº², åˆ¤æ–­æœ‰æ²¡æœ‰childrenå±æ€§
      if (!temp[temp[key].parentId].children) {
        temp[temp[key].parentId].children = []
      }
      // æœ‰å°±åŠ å…¥è¿›æ¥
      temp[temp[key].parentId].children.push(temp[key])
    } else {
      treeDate.push(temp[key])
    }
  }
  return treeDate
}

listToTree(data)
```

### æ ‘å½¢ç»“æ„è½¬æˆåˆ—è¡¨

```js
let data = [
  {
      id: 1,
      text: 'èŠ‚ç‚¹1',
      parentId: 0,
      children: [
          {
              id:2,
              text: 'èŠ‚ç‚¹1_1',
              parentId:1
          }
      ]
  }
]
// è½¬æˆ
// [
//   {
//       id: 1,
//       text: 'èŠ‚ç‚¹1',
//       parentId: 0 //è¿™é‡Œç”¨0è¡¨ç¤ºä¸ºé¡¶çº§èŠ‚ç‚¹
//   },
//   {
//       id: 2,
//       text: 'èŠ‚ç‚¹1_1',
//       parentId: 1 //é€šè¿‡è¿™ä¸ªå­—æ®µæ¥ç¡®å®šå­çˆ¶çº§
//   }
//   ...
// ]

```

#### è½¬åŒ–å‡½æ•°

```js
function treeToList(data) {
  let res = []
  const dfs = (tree) => {
    tree.forEach((item) => {
      if (item.children) {
        // é€’å½’å¾ªç¯(dfs => æ·±åº¦ä¼˜å…ˆæœç´¢)
        dfs(item.children)
        delete item.children
      }
      res.push(item)
    })
  }
  dfs(data)
  return res
}
treeToList(data)

```

## ç»§æ‰¿
ç»§æ‰¿æœ¬æ¬¡è¦å®ç°5ç§ç»§æ‰¿

### 1.åŸå‹é“¾ç»§æ‰¿

```js
function Student() {
  this.name = ['vvv', 'vvv2']
}
Student.prototype.say = function () {
  return this.name
}
function Vvv() {}
Vvv.prototype = new Student() // æ ¸å¿ƒ
// Vvv.prototype.constructor  === Student ä¸ºä»€ä¹ˆå‘¢
// å› ä¸ºlet s = new Student() å³Vvv.prototype === s (å³Vvvçš„åŸå‹æ˜¯Studentçš„å®ä¾‹)
// é‚£ä¹ˆVvv.prototype.constructor = s.constructor
// s.constructoræ˜¯Student
Vvv.prototype.constructor = Vvv 

let vvv3 = new Vvv()
vvv3.name.push('vvv3')
let vvv4 = new Vvv()
console.log(vvv4.name) // ['vvv', 'vvv2', 'vvv3']
```

**åŸå‹é“¾ç»§æ‰¿ç¼ºç‚¹**

- é—®é¢˜1ï¼šåŸå‹ä¸­åŒ…å«çš„å¼•ç”¨ç±»å‹å±æ€§å°†è¢«æ‰€æœ‰å®ä¾‹å…±äº«ï¼›  å¯ä»¥çœ‹åˆ°p1 pushçš„æ—¶å€™ p2ä¹Ÿæ”¹å˜äº†
- é—®é¢˜2ï¼šå­ç±»åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¸èƒ½ç»™çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚ï¼›

### 2.å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿

```js
function Student(name) {
  this.name = name
  this.getName = function () {
    return this.name
  }
}
function Vvv(name) {
  Student.call(this, name) // æ ¸å¿ƒ
}
let vvv = new Vvv('vvv')
vvv.getName() // vvv
let vvv2 = new Vvv('vvv2')
vvv2.getName() // vvv2
```

**å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹: å€Ÿç”¨æ„é€ å‡½æ•°å®ç°ç»§æ‰¿è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ 2 ä¸ªé—®é¢˜ï¼šå¼•ç”¨ç±»å‹å…±äº«é—®é¢˜ä»¥åŠä¼ å‚é—®é¢˜
- ç¼ºç‚¹: ç”±äºæ–¹æ³•å¿…é¡»å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ¯æ¬¡åˆ›å»ºå­ç±»å®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€éæ–¹æ³•

### 3.ç»„åˆç»§æ‰¿

```js
function Student(name) {
  this.name = name
}
Student.prototype.getName = function () {
  return this.name
}
function Vvv(name) {
  // ç¬¬äºŒæ¬¡
  Student.call(this, name)
}
// ç¬¬ä¸€æ¬¡
Vvv.prototype = new Student()
Vvv.prototype.constructor = Vvv


let vvv = new Vvv('vvv')
vvv.getName() // vvv
let vvv2 = new Vvv('vvv2')
vvv2.getName() // vvv2
```

**ç»„åˆç»§æ‰¿ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹: è§£å†³åŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿åˆ†åˆ«çš„ç¼ºç‚¹

- ç¼ºç‚¹: è°ƒç”¨äº†ä¿©æ¬¡çˆ¶ç±»æ„é€ å‡½æ•°


### 4.å¯„ç”Ÿç»„åˆç»§æ‰¿

```js
function Student(name) {
  this.name = name
}
Student.prototype.getName = function () {
  return this.name
}
function Vvv(name) {
  Student.call(this, name)
}
Vvv.prototype = Object.create(Student.prototype)
// è§£é‡Šä¸€ä¸‹ Vvv.prototype = Object.create(Student.prototype)
// ç”¨Object.createä»¥çˆ¶åŸå‹ä¸ºåŸå‹åˆ›å»ºå¯¹è±¡èµ‹å€¼ç»™å­åŸå‹
// let obj = Object.create(Student.prototype) 
// Vvv.prototype = obj
// obj æ˜¯ä»€ä¹ˆå‘¢? objæ˜¯ä»¥Student.prototypeä¸ºåŸå‹çš„å¯¹è±¡
Vvv.prototype.constructor = Vvv

let vvv = new Vvv('vvv')
vvv.getName() // vvv
let vvv2 = new Vvv('vvv2')
vvv2.getName() // vvv2
```

**å¯„ç”Ÿç»„åˆç»§æ‰¿ä¼˜ç‚¹**

- ç»„åˆç»§æ‰¿å·²ç»ç›¸å¯¹å®Œå–„äº†ï¼Œä½†è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œå®ƒçš„é—®é¢˜å°±æ˜¯è°ƒç”¨äº†2 æ¬¡çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œ ç¬¬ä¸€æ¬¡æ˜¯åœ¨ `new Student()`ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨ `Student.call()` è¿™é‡Œ

- ä¼˜ç‚¹: è§£å†³ç»„åˆç»§æ‰¿2 æ¬¡è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°


### 5.classç»§æ‰¿

```js
class Student {
  constructor(name) {
    this.name = name
  }
}
// æ ¸å¿ƒ: extends
class Vvv extends Student {
    constructor(name, age) {
      super(name)
       this.age = 18
    }
 }
```

 **classç»§æ‰¿**

- es6 classå®ç°ç»§æ‰¿å·²ç»ç›¸å¯¹å¾ˆç®€å•äº†

- å…¶åŸç†å°±æ˜¯ä½¿ç”¨äº†å¯„ç”Ÿç»„åˆç»§æ‰¿


## sleepå‡½æ•°

### æè¿°

sleepå‡½æ•°ä½œç”¨æ˜¯è®©çº¿ç¨‹ä¼‘çœ ï¼Œç­‰åˆ°æŒ‡å®šæ—¶é—´åœ¨é‡æ–°å”¤èµ·

### å®ç°

```js
function sleep(time) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve()
    }, time * 1000)
  })
}
```

## å¯¹è±¡çš„å±‚æ¬¡è·å–

### å®ç°

```js
/*
*obj  ä¼ å…¥çš„å¯¹è±¡
*keyName ä¹Ÿå°±æ˜¯a.cè¿™æ ·çš„å½¢å¼
*/
function lookup(obj, keyName) {
    //é¦–å…ˆåˆ¤æ–­keyNameæ˜¯å¦å«æœ‰.
    if (keyName.indexOf('.') != -1 && keyName != '.') {
        //æœ‰å°±æ‹†åˆ†
        let keys = keyName.split(".");
        let temp = obj;
        for (let i=0; i < keys.length; i++) {
            temp = temp[keys[i]];
        }
        //å¾ªç¯ç»“æŸåè¿”å›temp
        return temp;
    }
    //æ²¡æœ‰. å°±ç›´æ¥ä½¿ç”¨
    return obj[keyName];
}

// æµ‹è¯•
var obj = {
    aï¼š{
        c:{
          d:123
        }
    }
}
lookup({a:{c:{d:123}}},'a.c.d')  //123
```

## å¤§æ•°ç›¸åŠ 

åœ¨jsä¸­, **`Number.MAX_SAFE_INTEGER`** å¸¸é‡è¡¨ç¤ºåœ¨ JavaScript ä¸­æœ€å¤§çš„å®‰å…¨æ•´æ•°ï¼ˆmaxinum safe integer), ä¸€æ—¦è¶…å‡ºè¿™ä¸ªæ•°,å°±ä¼šå‡ºç°ç²¾åº¦**ä¸¢å¤±**é—®é¢˜, ä¾‹å¦‚: 

```js
let c = 9007199254740991
let d = 123456789999999999
d > Number.MAX_SAFE_INTEGER // true
c + d // 132463989254741000
```

æˆ‘ä»¬æƒ³è¦çš„ç»“æœæ˜¯`132463989254740990`, ä½†æ˜¯ç”±äºd è¶…å‡ºäº† JavaScript ä¸­æœ€å¤§çš„å®‰å…¨æ•´æ•°, æ‰€ä»¥å¯¼è‡´è¿ç®—é”™è¯¯, å› æ­¤æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª`add`æ–¹æ³•ä½¿å¾—å¤§æ•°å¯ä»¥ç›¸åŠ 

### å®ç°

```js
function add(a, b) {
  // 1.0 è¡¥é½ä½æ•°
  let maxLength = Math.max(a.length, b.length)
  /**
   * mdn: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/padStart
   * padStart() æ–¹æ³•ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²å¡«å……å½“å‰å­—ç¬¦ä¸² (å¦‚æœéœ€è¦çš„è¯ï¼Œä¼šé‡å¤å¤šæ¬¡)ï¼Œ
   * ä»¥ä¾¿äº§ç”Ÿçš„å­—ç¬¦ä¸²è¾¾åˆ°ç»™å®šçš„é•¿åº¦ã€‚ä»å½“å‰å­—ç¬¦ä¸²çš„å·¦ä¾§å¼€å§‹å¡«å……ã€‚
   */
  a = a.padStart(maxLength, 0) // '009007199254740991'     ä»å‰å¼€å§‹è¡¥é½ ç”¨0æ¥è¡¥é½
  b = b.padStart(maxLength, 0) // '123456789999999999'
  let t = 0;
  let f = 0; // è¿›ä½
  let sum = "" // æ‹¼æ¥
  for(let i = maxLength - 1; i >= 0; i--) {
    t = parseInt(a[i]) + parseInt(b[i]) + f
    f = Math.floor(t / 10) // æ˜¯å¦æœ‰è¿›ä½
    sum = (t % 10) + sum 
  }
  // æ˜¯å¦è¿˜å­˜åœ¨è¿›ä½
  if(f !== 0) {
    sum = '' + f + sum
  }
  return sum
}
```

## æœ‰æ•ˆæ‹¬å·

ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ `'('ï¼Œ')'ï¼Œ'{'ï¼Œ'}'ï¼Œ'['ï¼Œ']' `çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚

æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š

å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚
å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚

### å®ç°

```js
const isValid = (s) => {
  // å­—ç¬¦ä¸ºå•æ•° æˆ–è€…å­—ç¬¦ä»¥)]} å¼€å¤´çš„éƒ½ä¼šæ— æ³•é—­åˆ
  if (s.length % 2 === 1 || s[0] === ')' || s[0] === ']' || s[0] === '}') {
    return false
  }
  // å­˜å‚¨æ‹¬å·é—­åˆçš„ç±»å‹
  const pairs = new Map()
  pairs.set(')','(')
  pairs.set(']','[')
  pairs.set('}','{')

  // ä½¿ç”¨æ ˆçš„æ–¹å¼è¿›è¡Œåˆ¤æ–­ å…ˆè¿›åå‡º
  const stack = [] 
  // éå†æ‰€æœ‰å­—ç¬¦ä¸²
  for(let ch of s) {
    // chä¸­æ˜¯å¦å­˜åœ¨)]} çš„ä¸€ç§
    if(pairs.has(ch)) {
      // åˆ¤æ–­æœ€åä¸€ç»„æ˜¯å¦æ˜¯æœ‰æ•ˆæ‹¬å·
      if(!stack.length ||  stack[stack.length - 1] !== pairs.get(ch)) {
        return false
      }
      stack.pop()
    }else {
      stack.push(ch)
    }
  }
  return !stack.length
}
```

### è¯´æ˜

```html
ä¸¾ä¾‹å­
ä¾‹å¦‚: s = ()[]{}
å¼€å§‹è¿›æ ˆ(
ç„¶åä¸‹ä¸€æ¬¡)è¿›æ ˆ, ç„¶åè¿›å…¥pairs.has(ch) -> true -> stack.pop() å½“å‰æ ˆä¸ºç©º
ä¸‹ä¸€æ¬¡è¿›æ ˆ[ åŒç† (è®°ä½ )]} è¿™ä¸‰ä¸ªæ˜¯ä¸ä¼šè¿›å…¥åˆ°æ ˆä¸­çš„ )
```

## å®ç°forOf

MDNè§£é‡Š: **`for...of`è¯­å¥**åœ¨[å¯è¿­ä»£å¯¹è±¡](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols)ï¼ˆåŒ…æ‹¬ [`Array`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array)ï¼Œ[`Map`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map)ï¼Œ[`Set`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set)ï¼Œ[`String`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String)ï¼Œ[`TypedArrayç±»æ•°ç»„`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray)ï¼Œ[arguments](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/arguments) å¯¹è±¡ç­‰ç­‰ï¼‰ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å¾ªç¯ï¼Œè°ƒç”¨è‡ªå®šä¹‰è¿­ä»£é’©å­(`è¿­ä»£å™¨`)ï¼Œå¹¶ä¸ºæ¯ä¸ªä¸åŒå±æ€§çš„å€¼æ‰§è¡Œè¯­å¥

### å¯è¿­ä»£å¯¹è±¡

é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡

```js
typeof obj[Symbol.iterator] == "function"
```

å¦‚æœä¸Šè¿°å¼å­æˆç«‹çš„è¯, é‚£ä¹ˆæˆ‘ä»¬ç§°`obj`æ˜¯å¯è¿­ä»£å¯¹è±¡

`tips:åªæœ‰å¯è¿­ä»£å¯¹è±¡æ‰èƒ½ä½¿ç”¨for..of`

### è¿­ä»£å™¨åŸç†

åœ¨ä¸Šé¢ä»‹ç»äº†å¯è¿­ä»£å¯¹è±¡, åœ¨å¯è¿­ä»£å¯¹è±¡ä¸­è‚¯å®šä¼šå­˜åœ¨`è¿­ä»£å™¨`, å®ç°è¿­ä»£å™¨

```js
const  createIterator = (obj) => {
  let i = 0;
  return {
    next: function () {
      // done è¡¨ç¤ºæ˜¯å¦å·²ç»è¿­ä»£å®Œæˆ
      const done = i >= obj.length;
      const val = !done ? obj[i++] : undefined;
      return {
        done: done,
        value: val
      }
    }
  }
}
```

### å®ç°forOf

è®¤è¯†äº†`å¯è¿­ä»£å¯¹è±¡` å’Œ`è¿­ä»£å™¨åŸç†`å°±å¯ä»¥å®ç°forOfäº†

```js
/**
 * 
 * @param {*} obj å¯è¿­ä»£å¯¹è±¡
 * @param {*} callback å›è°ƒå‡½æ•°
 */
const forOf = (obj, callback) => {
  // iterableè¿­ä»£å™¨
  // resultç»“æœ
  let iterable, result;
  // å¦‚æœä¼ å…¥å¯¹è±¡Symbol.iteratorå±æ€§ç±»å‹ä¸æ˜¯functionï¼ŒæŠ›å‡ºé”™è¯¯ (è¯´æ˜ä¸æ˜¯å¯è¿­ä»£çš„å¯¹è±¡)
  if (typeof obj[Symbol.iterator] !== "function") {
    throw new TypeError(result + 'is not iterable');
  }
  // iterable = obj[Symbol.iterator]()
  // ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„createIterator
  iterable = createIterator(obj)
  result = iterable.next();
  
  while (!result.done) {
    // å›è°ƒå¤„ç†valå€¼
    callback(result.value)
    result = iterable.next();
  }
}

// æµ‹è¯•
forOf([1, 2, 3], (item) => {
  console.log(item);// 1,2,3
})
```

## setTimeoutæ¨¡æ‹Ÿå®ç°setInterval

ä¸ºä»€ä¹ˆç”¨ `setTimeout` æ›¿ä»£ `setInterval`? `setInterval`æœ‰ä»€ä¹ˆé—®é¢˜?

[ç‚¹å‡»äº†è§£](https://juejin.cn/post/6844904022051127310#heading-12)

### å®ç°

```js
/**
 * setTimeout æ¨¡æ‹Ÿå®ç° setInterval
 * @param {*} callback å›è°ƒå‡½æ•°
 * @param {*} delay å»¶è¿Ÿæ—¶é—´
 */
const mySetInterval  = (callback ,delay) =>{
  let timer = null
  const interval = () => {
    callback() // æ‰§è¡Œå›è°ƒ
    timer = setTimeout(interval, delay) // é€’å½’è°ƒç”¨
  }
  interval() // åˆå§‹æ‰§è¡Œ
  return {
    // æ¸…é™¤å®šæ—¶å™¨
    cancel: () => {
      clearTimeout(timer)
    }
  }
}

// æµ‹è¯•
let test = mySetInterval(() => {
  console.log(123);
}, 1000)

test.cancel() // æ¸…é™¤å®šæ—¶å™¨
```

## å®ç°å¯¹è±¡æ‰å¹³åŒ–
### è¦æ±‚

å®ç° flattenObjå‡½æ•°ï¼Œä¸ºä¸€ä¸ª javascript å¯¹è±¡ï¼ˆObject æˆ–è€… Arrayï¼‰ï¼Œè¿”å›å€¼ä¸ºæ‰å¹³åŒ–åçš„ç»“æœ

ä¾‹å¦‚:

```js
const input = {
  a: 1,
  b: [1, 2, { c: true }, [3]],
  d: { e: 2, f: 3 },
  g: null
}
```

```js
const flattenRes = flattenObj(input)
// æµ‹è¯•ç»“æœå¦‚ä¸‹
{
  "a": 1,
  "b[0]": 1,
  "b[1]": 2,
  "b[2].c": true,
  "b[3][0]": 3,
  "d.e": 2,
  "d.f": 3,
   // "g": null,  å€¼ä¸ºnullæˆ–è€…undefinedï¼Œä¸¢å¼ƒ
}
```

### å®ç°

```js
const flattenObj = obj => {
  // æ¥å—ç»“æœ
  let res = {}
  // é€’å½’
  const dfs = (target, oldKey) => {
    // éå†target
    for (let key in target) {
      let newKey // ç”¨äºä½œä¸ºè€çš„key
      if (oldKey) {
        // é€’å½’æœ‰è€key åˆ™ç»„åˆèµ·æ¥
        if (Array.isArray(target)) {
          // æ•°ç»„å˜ä¸º è€key[0]
          newKey = `${oldKey}[${key}]`
        } else {
          // å¯¹è±¡ï¼š è€key.a
          newKey = `${oldKey}.${key}`
        }
      } else {
        // æ²¡æœ‰oldKey, å³åˆå§‹åŒ–çŠ¶å†µ
        if (Array.isArray(target)) {
          // æ•°ç»„å˜ä¸º [0] [1]
          newKey = `[${key}]`
        } else {
          // å¯¹è±¡å˜ä¸º 'a' 'b'
          newKey = key
        }
      }
      if (Object.prototype.toString.call(target[key]) === '[object Object]' || Array.isArray(target[key])) {
        // é€’å½’æ•°ç»„å’Œå¯¹è±¡ ä¼ è¿›ç»„ç»‡å¥½çš„è€key
        dfs(target[key], newKey)
      } else if (target[key] !== null && target[key] !== undefined) {
        // é€’å½’å‡ºå£ å¸¸è§„æ•°æ® ç›´æ¥èµ‹å€¼
        res[newKey] = target[key]
      }
    }
  }
  dfs(obj, '')
  return res
}

// æµ‹è¯•
const input = {
  a: 1,
  b: [1, 2, { c: true }, [3]],
  d: { e: 2, f: 3 },
  g: null
}

const flattenRes = flattenObj(input)
// æµ‹è¯•ç»“æœå¦‚ä¸‹
{
  "a": 1,
  "b[0]": 1,
  "b[1]": 2,
  "b[2].c": true,
  "b[3][0]": 3,
  "d.e": 2,
  "d.f": 3,
   // "g": null,  å€¼ä¸ºnullæˆ–è€…undefinedï¼Œä¸¢å¼ƒ
}
```

## å®ç°Object.assign

### Object.assign

MDN: **`Object.assign()`** æ–¹æ³•å°†æ‰€æœ‰[å¯æšä¸¾](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable)ï¼ˆ`Object.propertyIsEnumerable()` è¿”å› trueï¼‰å’Œ[è‡ªæœ‰](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty)ï¼ˆ`Object.hasOwnProperty()` è¿”å› trueï¼‰å±æ€§ä»ä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ï¼Œè¿”å›ä¿®æ”¹åçš„å¯¹è±¡ã€‚[ç›´è¾¾MDNæ–‡æ¡£æŸ¥çœ‹](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

ä»MDNæ–‡æ¡£ä¸­å¯ä»¥çŸ¥é“å®ç°`Object.assign`çš„å‡ ä¸ªè¦æ±‚

- å¦‚æœç›®æ ‡å¯¹è±¡ä¸æºå¯¹è±¡å…·æœ‰ç›¸åŒçš„ [key](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys)ï¼Œåˆ™ç›®æ ‡å¯¹è±¡ä¸­çš„å±æ€§å°†è¢«æºå¯¹è±¡ä¸­çš„å±æ€§è¦†ç›–ï¼Œåé¢çš„æºå¯¹è±¡çš„å±æ€§å°†ç±»ä¼¼åœ°è¦†ç›–å‰é¢çš„æºå¯¹è±¡çš„å±æ€§ã€‚
- `Object.assign` æ–¹æ³•åªä¼šæ‹·è´æºå¯¹è±¡ *å¯æšä¸¾çš„* å’Œ *è‡ªèº«çš„* å±æ€§åˆ°ç›®æ ‡å¯¹è±¡ã€‚è¯¥æ–¹æ³•ä½¿ç”¨æºå¯¹è±¡çš„ `[[Get]]` å’Œç›®æ ‡å¯¹è±¡çš„ `[[Set]]`ï¼Œå®ƒä¼šè°ƒç”¨ [getters](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get) å’Œ [setters](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/set)ã€‚æ•…å®ƒåˆ†é…å±æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯å¤åˆ¶æˆ–å®šä¹‰æ–°çš„å±æ€§ã€‚å¦‚æœåˆå¹¶æºåŒ…å« gettersï¼Œè¿™å¯èƒ½ä½¿å…¶ä¸é€‚åˆå°†æ–°å±æ€§åˆå¹¶åˆ°åŸå‹ä¸­ã€‚(**å°±æ˜¯ä¸å¸Œæœ›åˆå¹¶åŸå‹ä¸Šçš„å±æ€§**)
- ä¸å¯æšä¸¾çš„å±æ€§ä¸ä¼šåˆå¹¶
- åŸºæœ¬ç±»å‹ä¼šè¢«åŒ…è£…æˆå¯¹è±¡

### å®ç°

```js
/**
 * Object._assign
 * @param {*} target  ç›®æ ‡å¯¹è±¡ï¼Œæ¥æ”¶æºå¯¹è±¡å±æ€§çš„å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¿®æ”¹åçš„è¿”å›å€¼
 * @param  {...any} sources  æºå¯¹è±¡ï¼ŒåŒ…å«å°†è¢«åˆå¹¶çš„å±æ€§
 */
Object._assign = (target, ...sources) => {
  // æ™®é€šç±»å‹åŒ…è£…æˆå¯¹è±¡ æ¯”å¦‚å­—ç¬¦ä¸²ç­‰...
  target = Object(target)
  for(let i = 0; i < sources.length; i++) {
    // è¿‡æ»¤æ‰è¦åˆå¹¶çš„å¯¹è±¡ä¸ºnullå’Œundefinedçš„æƒ…å†µ
    // (null == null  -> true )(null == undefined -> true)
    if(sources[i] == null) continue // ç»“æŸæœ¬æ¬¡å¾ªç¯ 
    // éå†è¦åˆå¹¶å¯¹è±¡çš„å±æ€§
    for(let key in sources[i]) {
      // inè¿ç®—ç¬¦ä¼šæŸ¥æ‰¾åŸå‹å¯¹è±¡ä¸Šçš„å¯æšä¸¾å±æ€§ï¼Œ
      // æ‰€ä»¥éœ€è¦é€šè¿‡Object.prototype.hasOwnPropertyæ–¹æ³•è¿‡æ»¤æ‰å¯¹è±¡åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§
      if(sources[i].hasOwnProperty(key)) {
        target[key] = sources[i][key]
      }
    } 
  }
  return target
}
```
### æµ‹è¯•

```js
const proto = { p: 'proto' }
const obj1 = { a: 'aa' }
const obj2 = { b: 'bb' }
// ä»¥protoä½œä¸ºæ–°å¯¹è±¡çš„åŸå‹
const obj3 = Object.create(proto, {
  c: {
    value: 'cc',
    enumerable: true,
  },
})
console.log(obj3) // {c: 'cc'}
// è¾“å‡ºobj3çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡
console.log(obj3.__proto__) // {p: 'proto'}



// è¯´æ˜ä¸ä¼šåˆå¹¶åŸå‹é“¾(__proto__) ä¸Šé¢çš„å±æ€§
const t1 = Object._assign({}, obj1, obj2)
console.log(t1) // {a: "aa", b: "bb"}
// è¿‡æ»¤åˆå¹¶å¯¹è±¡ä¸ºnullã€undefinedçš„æƒ…å†µ
const t2 = Object._assign({}, obj1, null, obj2, undefined)
console.log(t2) // {a: "aa", b: "bb"}
// åˆå¹¶å±æ€§
const t3 = Object._assign({}, obj1, obj2, obj3)
console.log(t3) // {a: "aa", b: "bb", c: "cc"}
```

### æµ‹è¯•2

```js
const v1 = 'abc';
const v2 = true;
const v3 = 10;
const v4 = Symbol('foo');

const obj = Object.assign({}, v1, null, v2, undefined, v3, v4);
// åŸºæœ¬ç±»å‹ä¼šè¢«åŒ…è£…ï¼Œnullå’Œundefinedä¼šè¢«å¿½ç•¥.
// åªæœ‰å­—ç¬¦ä¸²åŒ…è£…å™¨å¯ä»¥æœ‰è‡ªå·±çš„å¯æšä¸¾å±æ€§, æ‰€ä»¥true å’Œ 10ä¸ä¼šè¢«æ”¾è¿›æ¥
console.log(obj); // { "0": "a", "1": "b", "2": "c" }
```

## å®ç°composeç»„åˆå‡½æ•°

åœ¨å‡½æ•°å¼ç¼–ç¨‹å½“ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µå°±æ˜¯`å‡½æ•°ç»„åˆ`ï¼Œ å®é™…ä¸Šå°±æ˜¯æŠŠå¤„ç†æ•°æ®çš„å‡½æ•°åƒç®¡é“ä¸€æ ·è¿æ¥èµ·æ¥ï¼Œ ç„¶åè®©æ•°æ®ç©¿è¿‡ç®¡é“å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚ä¾‹å¦‚:

```js
function add(a, b) {
  return a + b
}
function len (str) {
  return str.length
}
function preFix(str) {
   return `###${str}`
}
console.log(preFix(len(add(1, '1')))); // ###2
```

æˆ‘ä»¬æƒ³è¾“å‡ºçš„æ˜¯ä¸€ä¸ª`å¤šå±‚å‡½æ•°åµŒå¥—`çš„è¿è¡Œç»“æœï¼Œå³æŠŠ`å‰ä¸€ä¸ªå‡½æ•°çš„è¿è¡Œç»“æœèµ‹å€¼ç»™åä¸€ä¸ªå‡½æ•°`ã€‚ä½†æ˜¯å¦‚æœéœ€è¦åµŒå¥—å¤šå±‚å‡½æ•°ï¼Œé‚£è¿™ç§`ç±»ä¼¼äºf(g(h(x)))`çš„å†™æ³•å¯è¯»æ€§å¤ªå·®ï¼Œæˆ‘ä»¬è€ƒè™‘èƒ½ä¸èƒ½å†™æˆ`(f, g, h)(x)`è¿™ç§ç®€å•ç›´è§‚çš„å½¢å¼ï¼Œäºæ˜¯compose()å‡½æ•°å°±æ­£å¥½å¸®åŠ©æˆ‘ä»¬å®ç°ã€‚

### å®ç°

```js
const composeRight = (...fns) => {
  return function (...args) {
    const len = fns.length // è·å–åˆ°å‡½æ•°ä¸ªæ•°
    // å¤„ç†fns < 2 çš„æƒ…å†µ
    if(len === 0) return args
    if(len === 1) return fns[0](...args)
    // å¤„ç†fns > 2çš„æƒ…å†µ
    const lastFn = fns && fns.pop() // è·å–åˆ°æœ€åä¸€ä¸ªå‡½æ•°
    // è·å–åˆ°æœ€åä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œ, å¹¶è·å–å‡½æ•°è¿”å›ç»“æœä½œä¸ºreduceçš„åˆå§‹å€¼
    let prev = lastFn(...args)
    // reduceRight ä»å³å¾€å·¦è¿›è¡Œreduce
    return fns.reduceRight((prev, cur) => {
      return cur(prev)
    }, prev)
  }
}
```

### æµ‹è¯•

```js
function add(a, b) {
  return a + b
}
function len (str) {
  return str.length
}
function preFix(str) {
   return `###${str}`
}

let retFn = composeRight(preFix, len, add ) // è¿”å›ä¸€ä¸ªå‡½æ•°
console.log(retFn);
// ...args => 1, '1', ç„¶åå¼€å§‹æ‰§è¡Œ
// lastFn(...args) = > add(1, '1') => 11 => å¼€å§‹è¿›è¡Œreduce
/**
 * return fns.reduceRight((prev, cur) => {
 *     return cur(prev)  // å¼€å§‹çš„curæ˜¯len => len(11) => 2, æœ€åæ˜¯preFix
 *  }, 11)
 */
console.log(retFn(1, '1')); // ###2
```

## å®ç°instanceof

MDNæè¿°: **`instanceof`** **è¿ç®—ç¬¦**ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ `prototype` å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚

è¯­æ³•: 

```js
object instanceof constructor
object  -> æŸä¸ªå®ä¾‹å¯¹è±¡
constructor  -> æŸä¸ªæ„é€ å‡½æ•°
```

ç†è§£: `instanceof` è¿ç®—ç¬¦ç”¨æ¥æ£€æµ‹ `constructor.prototype `æ˜¯å¦å­˜åœ¨äºå‚æ•° `object` çš„åŸå‹é“¾ä¸Šã€‚

### å®ç°

```js
/**
 * instanceof
 * @param {*} left æŸä¸ªå®ä¾‹å¯¹è±¡
 * @param {*} right æŸä¸ªæ„é€ å‡½æ•°
 */
const myInstanceof = (left, right) => {
  // å¤„ç†è¾¹ç•Œæƒ…å†µ
  if ((typeof left !== 'object' || left === null) && typeof left !== 'function') return false
  if (!right.prototype) throw new TypeError("Right-hand side of 'myInstanceof' is not an object")
  
  let leftProto = Object.getPrototypeOf(left)
  const rightPrototype = right.prototype
  while (leftProto !== null) {
    if (leftProto === rightPrototype) {
      return true
    }
    leftProto = Object.getPrototypeOf(leftProto)
  }
  return false
}
```

### æµ‹è¯•1

å·¦è¾¹ä¸ä¸ºå¯¹è±¡

```js
console.log(myInstanceof(1, Object)) // false
1 instanceof Object // false
```

### æµ‹è¯•2

å³è¾¹ä¸ä¸ºæ„é€ å‡½æ•°

```js
const obj = {}
console.log(myInstanceof(obj, 1)) // Uncaught TypeError: Right-hand side of 'myInstanceof' is not an object
obj instanceof 1 // æŠ¥é”™ Uncaught TypeError: Right-hand side of 'instanceof' is not an object
```

### æµ‹è¯•3

å·¦è¾¹ä¸ºå¯¹è±¡, å³è¾¹ä¸ºæ„é€ å‡½æ•°

```js
const fn = () => {}
console.log(myInstanceof(fn, Function)) // true
fn instanceof Function // true
```

ä¸åŒ¹é…çš„ç°è±¡

```js
const fn = () => {}
console.log(myInstanceof(fn, Array)) // false
fn instanceof Array // false
```


## å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼

å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼ å…·æœ‰`on` ` off`  `once` `emit`æ–¹æ³•

### å®ç°

```js
class EventEmitter {
  constructor() {
    // æ‰€æœ‰è®¢é˜…äº‹ä»¶(äº‹ä»¶ä¸­å¿ƒ)
    this.events = {}
  }
  /**
   * è®¢é˜…äº‹ä»¶
   * @param {*} type è®¢é˜…çš„ç±»å‹
   * @param {*} callback äº‹ä»¶
   */
  on(type, callback) {
    if (!this.events[type]) {
      this.events[type] = [callback]
    } else {
      this.events[type].push(callback)
    }
  }
  // å–æ¶ˆè®¢é˜…äº‹ä»¶
  off(type, callback) {
    this.events[type] && (this.events[type] = this.events[type].filter(fn => fn !== callback))
  }
  // åªè§¦å‘ä¸€æ¬¡äº‹ä»¶, ä¹‹åä¸å†è§¦å‘
  once(type, callback) {
    const fn = () => {
      callback()
      this.off(type, fn)
    }
    // åœ¨è®¢é˜…äº‹ä»¶çš„åŒæ—¶, è§¦å‘ä¸€æ¬¡åå°±ä¼šå–æ¶ˆè®¢é˜…çš„äº‹ä»¶
    this.on(type, fn)
  }
  // å‘å¸ƒ(è§¦å‘)äº‹ä»¶
  emit(type, ...rest) {
    this.events[type] && this.events[type].forEach(fn => fn(...rest))
  }
}
```

### æµ‹è¯•

æµ‹è¯•`emit`

```js
const events = new EventEmitter()

const handle = (...rest) => {
  console.log(rest)
}

events.on('click', handle)

events.emit('click', 1, 2, 3, 4)  // [1, 2, 3, 4]
```

æµ‹è¯•`off`

```js
const events = new EventEmitter()

const handle = (...rest) => {
  console.log(rest)
}

events.on('click', handle)

events.emit('click', 1, 2, 3, 4)  // [1, 2, 3, 4]

events.off('click', handle)

events.emit('click', 1, 2) // å–æ¶ˆäº†ä¸æ‰“å°
```

æµ‹è¯•`once`

```js
events.once('dbClick', () => {
  console.log(123456)
})
events.emit('dbClick') // 123456, åªæœ‰ç¬¬ä¸€æ¬¡è§¦å‘
events.emit('dbClick')
events.emit('dbClick')
events.emit('dbClick')
events.emit('dbClick')
```

## å®ç°call/apply/bind

`call` `apply` `bind` è¿™ä¸‰ç§æ–¹æ³•éƒ½æ˜¯å¯ä»¥æ”¹å˜thisçš„æŒ‡å‘çš„, bindçš„å®ç°ä¼šè¾ƒéš¾
### call

callçš„ä½œç”¨

- 1.ä¼šæ”¹å˜thisæŒ‡å‘
- 2.ä¼šè‡ªåŠ¨è°ƒç”¨å‡½æ•°

#### å®ç°

```js
/**
 *
 * @param {*} context context (æ”¹å˜çš„thisæŒ‡å‘å¯¹è±¡)
 * @param  {...any} args å‚æ•°
 */
Function.prototype.myCall = function (context, ...args) {
  // 1.contextä¸ºç©ºæˆ–è€…nullæ—¶ ,thisæŒ‡å‘window
  if (!context || context == null) {
    context = window
  }
  // 2. åˆ›å»ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ª fn
  let fn = Symbol()
  // 3. å°†thisæŒ‡å‘contextä¸­çš„fn, thisæŒ‡çš„æ˜¯è°ƒç”¨è€…
  context[fn] = this
  // 4. è°ƒç”¨å‡½æ•°fn, å¹¶è·çš„è¿”å›å€¼
  const ret = context[fn](...args)
  // 5.åˆ é™¤ fn
  delete context[fn]
  // è¿”å›å‡½æ•°è¿”å›å€¼
  return ret
}
```

#### æµ‹è¯•

```js
// æµ‹è¯•
let obj = {
  a(params) {
    console.log(this, params)
  }
}
let obj2 = {
  b() {}
}
let obj3 = {
  c() {

  }
}
// obj.a(123) // this->obj
obj.a.call(obj2, 1234) // this -> obj2
obj.a.myCall(obj2, 1234) // this -> obj2
```

#### æ€»ç»“

å®ç°callå…±6æ­¥

- 1.contextä¸ºç©ºæˆ–è€…nullæ—¶ ,thisæŒ‡å‘window
- 2.åˆ›å»ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ª fn
- 3.å°†thisæŒ‡å‘contextä¸­çš„fn, `thisæŒ‡çš„æ˜¯è°ƒç”¨è€…`
- 4.è°ƒç”¨å‡½æ•°fn, å¹¶è·çš„è¿”å›å€¼
- 5.åˆ é™¤ fn
- 6.è¿”å›å‡½æ•°è¿”å›å€¼

### apply

applyçš„ä½œç”¨

- 1.ä¼šæ”¹å˜thisæŒ‡å‘
- 2.ä¼šè‡ªåŠ¨è°ƒç”¨å‡½æ•°
- 3.å‚æ•°ä¸ºæ•°ç»„(`è·Ÿcallçš„åŒºåˆ«`)

##### å®ç°

```js
/**
 * å®ç°æ–¹æ³•å’Œcallå·®ä¸å¤š
 * apply
 * @param {*} context context (æ”¹å˜çš„thisæŒ‡å‘å¯¹è±¡)
 * @param  {...any} args  å‚æ•°
 */

 Function.prototype.myApply = function (context, args) {
  // 1.contextä¸ºç©ºæˆ–è€…nullæ—¶ ,thisæŒ‡å‘window
  if (!context || context == null) {
    context = window
  }
  // 2.åˆ›å»ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ª fn
  let fn = Symbol()
  // 3.å°†thisæŒ‡å‘contextä¸­çš„fn, thisæŒ‡çš„æ˜¯è°ƒç”¨è€…
  context[fn] = this
  // 4.è°ƒç”¨å‡½æ•°fn, å¹¶è·çš„è¿”å›å€¼
  const ret = context[fn](...args)
  // 5.åˆ é™¤ fn
  delete context[fn]
  // 6.è¿”å›å‡½æ•°è¿”å›å€¼
  return ret
}
```

æµ‹è¯•æ–¹å¼å’Œæ€»ç»“è·Ÿ`call`çš„å·®ä¸å¤š

### bind(é‡ç‚¹)

bindçš„ä½œç”¨

- 1.æ–°å‡½æ•°çš„thisè¢«æŒ‡å®šä¸ºbindçš„ç¬¬ä¸€ä¸ªå‚æ•°
- 2.`è¿”å›ä¸€ä¸ªå‡½æ•°`
- 3.å…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•° 
- 4.åœ¨ bind çš„æ—¶å€™,å¯ä»¥è¿›è¡Œä¼ å‚
- 5.å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆ

#### å®ç°

```js
Function.prototype.myBind = function(context, ...args1) {
  // 1.contextä¸ºç©ºæˆ–è€…nullæ—¶ ,thisæŒ‡å‘window
  if (!context || context == null) {
    context = window
  }
   // 2. åˆ›å»ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ª fn
  let fn = Symbol();
  context[fn] = this;
  let self = this // éœ€è¦ä¿å­˜å½“å‰æŒ‡å‘
  // 3.ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°, è¿™ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°
  const result = function(...args2) { 
   // ç¬¬ä¸€ç§æƒ…å†µ :è‹¥æ˜¯å°† bind ç»‘å®šä¹‹åçš„å‡½æ•°å½“ä½œæ„é€ å‡½æ•°ï¼Œé€šè¿‡ new æ“ä½œç¬¦ä½¿ç”¨ï¼Œåˆ™ä¸ç»‘å®šä¼ å…¥çš„ thisï¼Œè€Œæ˜¯å°† this æŒ‡å‘å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡
    // æ­¤æ—¶ç”±äºnewæ“ä½œç¬¦ä½œç”¨  thisæŒ‡å‘resultå®ä¾‹å¯¹è±¡  è€Œresultåˆç»§æ‰¿è‡ªä¼ å…¥çš„self æ ¹æ®åŸå‹é“¾çŸ¥è¯†å¯å¾—å‡ºä»¥ä¸‹ç»“è®º
    // this.__proto__ === result.prototype   // this instanceof result =>true
    // this.__proto__.__proto__ === result.prototype.__proto__ === self.prototype; // this instanceof self =>true
   
    if (this instanceof self) {
      // æ­¤æ—¶thisæŒ‡å‘æŒ‡å‘resultçš„å®ä¾‹  è¿™æ—¶å€™ä¸éœ€è¦æ”¹å˜thisæŒ‡å‘
      this[fn] = self;
      this[fn](...[...args1, ...args2]); // è¿™é‡Œä½¿ç”¨es6çš„æ–¹æ³•è®©bindæ”¯æŒå‚æ•°åˆå¹¶
    } else {
      // å¦‚æœåªæ˜¯ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨  é‚£å°±å¾ˆç®€å•äº† ç›´æ¥æ”¹å˜thisæŒ‡å‘ä¸ºä¼ å…¥çš„context
      context[fn](...[...args1, ...args2]);
    }
  }
  // å¦‚æœç»‘å®šçš„æ˜¯æ„é€ å‡½æ•° é‚£ä¹ˆéœ€è¦ç»§æ‰¿æ„é€ å‡½æ•°åŸå‹å±æ€§å’Œæ–¹æ³•
  // å®ç°ç»§æ‰¿çš„æ–¹å¼: ä½¿ç”¨Object.create
  result.prototype = Object.create(this.prototype);
  return result;
}
```

#### æµ‹è¯•

```js
function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.add = function() {
  return this.x + this.y;
};

let F = Point.myBind(null, 1)
// let F = Point.bind(null, 1)
let f = new F(6)
f.add()  // 7
```

#### æ€»ç»“

`bind`çš„å®ç°ç›¸å¯¹è¾ƒéš¾ç†è§£

- `bind`è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°
- è¿”å›çš„å‡½æ•°å¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°(æ­¤æ—¶å°†ä¸åœ¨æ”¹å˜æŒ‡å‘, ä½¿ç”¨çš„æ˜¯`newå‡ºæ¥çš„å®ä¾‹ä½œä¸ºthisæŒ‡å‘`)
- `å¹¶ä¸”åœ¨å¯ä»¥äºŒæ¬¡ä¼ å…¥å‚æ•°, ç¬¬ä¸€ä¸ªæ˜¯åœ¨ä½¿ç”¨bindçš„æ—¶å€™, ç¬¬äºŒæ¬¡æ˜¯åœ¨è¿”å›çš„å‡½æ•°èº«ä¸Š(é‡ç‚¹)`


## å®ç°create

MDNæè¿°: **`Object.create()`** æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥ä½œä¸ºæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹ï¼ˆprototypeï¼‰ã€‚

### ä¸ºä»€ä¹ˆä½¿ç”¨Object.create

è¯­æ³•

```js
 // è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¸¦ç€æŒ‡å®šçš„åŸå‹å¯¹è±¡å’Œå±æ€§ã€‚
Object.create(protoï¼Œ[propertiesObject])
```

- protoï¼šæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œå¿…é¡»ä¸º`null`æˆ–è€…åŸå§‹åŒ…è£…å¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸

- propertiesObjectï¼šå¯é€‰å‚æ•°ï¼Œéœ€è¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥ä¼ å…¥å¯¹è±¡çš„è‡ªæœ‰å¯æšä¸¾å±æ€§(å³å…¶è‡ªèº«å®šä¹‰çš„å±æ€§ï¼Œè€Œä¸æ˜¯å…¶åŸå‹é“¾ä¸Šçš„æšä¸¾å±æ€§)å°†ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ æŒ‡å®šçš„å±æ€§å€¼å’Œå¯¹åº”çš„å±æ€§æè¿°ç¬¦

  

ä¸ºä½•è¦ä½¿ç”¨`Object.create`åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨å¯¹è±¡å­—é¢é‡çš„å½¢å¼æˆ–è€…ä½¿ç”¨`Object`åˆ›å»ºå¯¹è±¡å‘¢ï¼Ÿ

```js
const obj = {
    name: "nordon",
};

const newObj = Object.create(obj);
const nweObj2 = Object(obj);
```

é€šè¿‡è¾“å‡ºå¯ä»¥çœ‹åˆ°é€šè¿‡å­—é¢é‡å’Œä½¿ç”¨`Object`åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€è‡´çš„ï¼Œä¸”å…¶å¼•ç”¨åœ°å€æ˜¯ä¸€è‡´çš„ï¼š`obj === newObj2`ä¸º`true`

é€šè¿‡`Object.create`å¸¸è§çš„å¯¹è±¡ä¼šåœ¨`obj`å’Œ`newObj`ä¹‹é—´å¢åŠ ä¸€å±‚ï¼Œè¿™ä¸ªæ—¶å€™å¼•ç”¨åœ°å€æ˜¯è§£è€¦çš„ï¼š`obj === newObj`ä¸ºfalseï¼Œè¿™æ ·çš„å¥½å¤„å¯ä»¥ä¿è¯æ–°åˆ›å»ºçš„å¯¹è±¡å’ŒåŸæœ‰å¯¹è±¡è§£è€¦ï¼Œå½“æˆ‘ä»¬æ“ä½œ`newObj`æ—¶å¹¶ä¸ä¼šå½±å“åŸæœ‰æ•°æ®

### Object.createçš„åº”ç”¨åœºæ™¯

åˆ©ç”¨`Object.create`å®ç°ç»§æ‰¿

```js
function Person(name) {
  this.name = name;
  this.permission = ["user", "salary", "vacation"];
}

Person.prototype.say = function () {
  console.log(`${this.name} è¯´è¯äº†`);
};

function Staff(name, age) {
  Person.call(this, name);
  this.age = age;
}

Staff.prototype = Object.create(Person.prototype, {
  constructor: {
      // è‹¥æ˜¯ä¸å°†Staff constructoræŒ‡å›åˆ°Staff, æ­¤æ—¶çš„Staffå®ä¾‹zs.constructoråˆ™æŒ‡å‘Person
      value: Staff,
  },
});

let s = new Staff('xm', 18)
s.say() // xm è¯´è¯äº†

```

### å®ç°

```js
/**
 * Object.create()
 * ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥ä½œä¸ºæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹ï¼ˆprototypeï¼‰
 * @param {*} proto åŸå‹(å¯¹è±¡)
 * @returns è¿”å›å¯¹è±¡
 */
const create = (proto) => {
  // åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°
  function F() {}
  F.prototype = proto
  return new F() // è¿”å›å®ä¾‹
}
```

Objectçš„å®ç°ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•, ä½†æ˜¯ä¹Ÿéœ€è¦ç†è§£åŸå‹ä¸åŸå‹é“¾ä¸Šå¾—çŸ¥è¯†

## å®ç°å¹¶è¡Œé™åˆ¶çš„Promiseè°ƒåº¦å™¨

### æè¿°

é¢˜ç›®æè¿°: å®ç°ä¸€ä¸ªå¸¦å¹¶å‘é™åˆ¶çš„å¼‚æ­¥è°ƒåº¦å™¨ Schedulerï¼Œä¿è¯åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æœ€å¤šæœ‰ä¸¤ä¸ª

```js
addTask(1000,"1");
addTask(500,"2");
addTask(300,"3");
addTask(400,"4");
è¾“å‡ºé¡ºåºæ˜¯ï¼š2 3 1 4

æ•´ä¸ªçš„å®Œæ•´æ‰§è¡Œæµç¨‹ï¼š

ä¸€å¼€å§‹1ã€2ä¸¤ä¸ªä»»åŠ¡å¼€å§‹æ‰§è¡Œ
500msæ—¶ï¼Œ2ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º2ï¼Œä»»åŠ¡3å¼€å§‹æ‰§è¡Œ
800msæ—¶ï¼Œ3ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º3ï¼Œä»»åŠ¡4å¼€å§‹æ‰§è¡Œ
1000msæ—¶ï¼Œ1ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º1ï¼Œæ­¤æ—¶åªå‰©ä¸‹4ä»»åŠ¡åœ¨æ‰§è¡Œ
1200msæ—¶ï¼Œ4ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º4
```

### å®ç°

```js
class Scheduler {
  constructor(limit) {
    this.queue = [] // é˜Ÿåˆ—
    this.maxCount = limit // ä¿è¯æœ€å¤§çš„è¿è¡Œæ•°é‡
    this.runCounts = 0 // æ­£åœ¨è¿è¡Œçš„ä¸ªæ•°
  }
  // æ·»åŠ ä»»åŠ¡
  add(time, order) {
    const promiseCreator = () => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          console.log(order)
          resolve()
        }, time)
      })
    }
    // åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­
    this.queue.push(promiseCreator)
  }
  // å¼€å§‹ä»»åŠ¡
  start() {
    for (let i = 0; i < this.maxCount; i++) {
      this.request()
    }
  }
  // æ‰§è¡Œä»»åŠ¡
  request() {
    if (!this.queue.length || this.runCounts >= this.maxCount) return
    // ä»é˜Ÿåˆ—ä¸­æ‹¿å‡ºä»»åŠ¡å¼€å§‹æ‰§è¡Œ
    this.runCounts++
    const task = this.queue.shift()
    // æ‰§è¡Œ(è°ƒç”¨)ä»»åŠ¡åè¿”å›promise
    task().then(() => {
      // æ‰§è¡Œå®Œæ¯•årunCounts--
      this.runCounts--
      // å¹¶æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡
      this.request()
    })
  }
}
```

### æµ‹è¯•

```js
const scheduler = new Scheduler(2);
const addTask = (time, order) => {
  scheduler.add(time, order);
};
addTask(1000, "1");
addTask(500, "2");
addTask(300, "3");
addTask(400, "4");
scheduler.start();  // 2 3 1 4

// ä¸€å¼€å§‹1ã€2ä¸¤ä¸ªä»»åŠ¡å¼€å§‹æ‰§è¡Œ
// 500msæ—¶ï¼Œ2ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º2ï¼Œä»»åŠ¡3å¼€å§‹æ‰§è¡Œ
// 800msæ—¶ï¼Œ3ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º3ï¼Œä»»åŠ¡4å¼€å§‹æ‰§è¡Œ
// 1000msæ—¶ï¼Œ1ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º1ï¼Œæ­¤æ—¶åªå‰©ä¸‹4ä»»åŠ¡åœ¨æ‰§è¡Œ
// 1200msæ—¶ï¼Œ4ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡º4
```

### æ€»ç»“

å®ç°å¹¶è¡Œé™åˆ¶çš„Promiseè°ƒåº¦å™¨éœ€è¦æŒæ¡`promise`çš„çŸ¥è¯†,é€šè¿‡å®šæ—¶å™¨æ¥æ§åˆ¶è¾“å‡ºä»»åŠ¡çš„é¡ºåº

## å®ç°LazyMan

### é¢˜ç›®æè¿°

```js
const vvv = new LazyMan('vvv')
vvv.sleep(2).eat('dinner')
// è¾“å‡º
Hi! my name is vvv
ç­‰å¾…2s
eat dinner
```

```js
vvv.eat('dinner').sleep(2)
// è¾“å‡º
Hi! my name is vvv
eat dinner
ç­‰å¾…2s
```

```js
vvv.eat('dinner').sleepFirst(2)
// è¾“å‡º
```

`sleep`æ–¹æ³•ä¼šå»¶è¿Ÿåé¢çš„è¾“å‡º, `eat`æ–¹æ³•ç›´æ¥è¾“å‡º, `sleepFirst`æ–¹æ³•å»¶è¿Ÿä¼šåœ¨å¼€å§‹

### å®ç°

```js
class LazyMan {
  constructor(name) {
    this.tasks = [] // ä»»åŠ¡åˆ—è¡¨
    const task = () => {
      console.log(`Hi! my name is ${name}`)
      this.run() // æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
    }
    this.tasks.push(task)
    // å¼€å§‹æ‰§è¡Œä»»åŠ¡
    setTimeout(() => {
      this.run()
    }, 0)
  }
  // ç›´æ¥è¾“å‡º
  eat(food) {
    const task = () => {
      console.log(`eat ${food}`)
      this.run()
    }
    this.tasks.push(task)
    return this
  }
  // æ‰§è¡Œä»»åŠ¡, å–å‡ºç¬¬ä¸€ä¸ª, è°ƒç”¨
  run() {
    const task = this.tasks.shift() // å–ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ
    task && task()
  }
  // å»¶è¿Ÿè¾“å‡º
  sleep(time) {
    this.sleepWrapper(time)
    return this
  }
  // å°†å»¶è¿Ÿä¼šåœ¨å¼€å§‹
  sleepFirst(time) {
    this.sleepWrapper(time, true)
    return this
  }
  sleepWrapper(time, first) {
    const task = () => {
      setTimeout(() => {
        console.log(`ç­‰å¾…${time}s`)
        this.run()
      }, time * 1000)
    }
    if (first) {
      this.tasks.unshift(task)
    } else {
      this.tasks.push(task) // åœ¨æ ˆå°¾åŠ å…¥
    }
  }
}
```

### æ€»ç»“

lazyManä¸»è¦è€ƒå¯Ÿçš„ç‚¹æ˜¯å¯¹`é“¾å¼è°ƒç”¨`ä»¥åŠ`æ ˆç»“æ„`

## å®ç°maxRequest

### æè¿°

å®ç°maxRequestï¼ŒæˆåŠŸåresolveç»“æœï¼Œå¤±è´¥åé‡è¯•ï¼Œå°è¯•è¶…è¿‡ä¸€å®šæ¬¡æ•°æ‰è¿”å›çœŸæ­£çš„reject

### å®ç°

```js
/**
 * maxRequest
 * @param {*} fn éœ€è¦æ‰§è¡Œçš„å‡½æ•°
 * @param {*} max æœ€å¤§å°è¯•æ¬¡æ•°
 */
const maxRequest = (fn, max) => {
  return new Promise((resolve, reject) => {
    // idxæœ€å¤§è¯·æ±‚æ¬¡æ•°
    const dfs = idx => {
      Promise.resolve(
        fn().then(val => {
            // æˆåŠŸçš„è¯ç›´æ¥resolve
            resolve(val)
          })
          .catch(err => {
            // å¤±è´¥å°±ç›´æ¥ç»™idx-1 å†é€’å½’
            if (idx - 1 > 0) {
              help(idx - 1)
            } else {
              // å¦‚æœæœ€åä¸€æ¬¡äº†å°±rejectè¿”å›
              reject(err)
            }
          })
      )
    }
    dfs(max)
  })
}
```



<br/>
<hr />

â­ï¸â­ï¸â­ï¸å¥½å•¦ï¼ï¼ï¼æœ¬æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸå•¦ã€‚â­ï¸â­ï¸â­ï¸

âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿

æ’’èŠ± ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸
